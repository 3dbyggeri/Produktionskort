<% semantic_form_for @work_process do |f| %>
  <% f.inputs :name => 'Stamdata' do %>
    <% f.semantic_fields_for :project do |p| %>
      <% p.inputs do %>
      <%- if @work_process.project.id.blank? -%>
        <div id="fetch_project"><%= link_to_add_fetch_project_form "Hent eksisterende sag" %></div>
        <div id="import_project"><%= link_to_add_import_project_form "Importer stamdata" %></div>
        <input id="work_process_project_attributes_id" name="work_process[project_attributes][id]" type="hidden" value="" />
      <%- end -%>
        <%= p.input :name %>
        <%= p.input :address %>
        <%= p.input :postal_code %>
        <%= p.input :title_number %>
        <%= p.input :health_safety_decided_by_owner %>
        <%= p.input :health_safety_decided_by_contractor %>
        <%= p.input :health_safety_plan %>
        <%= p.input :health_safety_plan_location %>
      <% end %>
    <% end %>
    <fieldset class="table_group"><legend><span>Adresser</span></legend>
    <% f.semantic_fields_for :companies do |builder| %>
      <%= render 'company_fields', :f => builder %>
    <% end %>
    <p><%= link_to_add_fields "Tilføj virksomhed", f, :companies %></p>
    </fieldset>

    <% f.semantic_fields_for :project do |p| %>
      <% p.inputs do %>
    
      <fieldset class="table_group"><legend><span>Personer</span></legend>
      <% p.semantic_fields_for :people do |builder| %>
        <%= render 'person_fields', :f => builder %>
      <% end %>
      <p><%= link_to_add_fields "Tilføj person", p, :people %></p>
      </fieldset>

      <fieldset class="table_group"><legend><span>Møder</span></legend>
      <% p.semantic_fields_for :meetings do |builder| %>
        <%= render 'meeting_fields', :f => builder %>
      <% end %>
      <p><%= link_to_add_fields "Tilføj møde", p, :meetings %></p>
      </fieldset>

      <fieldset class="table_group"><legend><span>Godkendelser</span></legend>
      <% p.semantic_fields_for :approvals do |builder| %>
        <%= render 'approval_fields', :f => builder %>
      <% end %>
      <p><%= link_to_add_fields "Tilføj godkendelse", p, :approvals %></p>
      </fieldset>

      <fieldset class="table_group"><legend><span>Hensyn</span></legend>
      <% p.semantic_fields_for :attentions do |builder| %>
        <%= render 'attention_fields', :f => builder %>
      <% end %>
      <p><%= link_to_add_fields "Tilføj hensyn", p, :attentions %></p>
      </fieldset>

      <% end %>
    <% end %>

  <% end %>

  <% f.inputs :name => 'Byggeplads' do %>
  
  <% f.semantic_fields_for :project do |p| %>
    <% p.inputs do %>
  
    <fieldset class="table_group"><legend><span>Henvisninger</span></legend>
    <% p.semantic_fields_for :site_referrals do |builder| %>
      <%= render 'site_referral_fields', :f => builder %>
    <% end %>
    <p><%= link_to_add_fields "Tilføj henvisning", p, :site_referrals %></p>
    </fieldset>

    <fieldset class="table_group"><legend><span>Byggepladsfokus</span></legend>
    <% p.semantic_fields_for :site_focuses do |builder| %>
      <%= render 'site_focus_fields', :f => builder %>
    <% end %>
    <p><%= link_to_add_fields "Tilføj fokusområde", p, :site_focuses %></p>
    </fieldset>

    <fieldset class="table_group"><legend><span>Byggepladsdrift</span></legend>
    <% p.semantic_fields_for :site_operations do |builder| %>
      <%= render 'site_operation_fields', :f => builder %>
    <% end %>
    <p><%= link_to_add_fields "Tilføj driftsinformation", p, :site_operations %></p>
    </fieldset>

    <fieldset class="table_group"><legend><span>Materiel</span></legend>
    <% p.semantic_fields_for :equipment do |builder| %>
      <%= render 'equipment_fields', :f => builder %>
    <% end %>
    <p><%= link_to_add_fields "Tilføj materiel", p, :equipment %></p>
    </fieldset>

    <% end %>
  <% end %>
  
  <% end %>

  <% f.inputs :name => 'Planlægning og opfølgning' do %>
  <% end %>

  <% f.inputs :name => 'Aktivitet' do %>
    <%= f.input :activity %>
    <%= f.input :location %>
    <%= f.input :project_delivery_time, :as => :date %>
    <%= f.input :project_delivery_person %>

    <fieldset class="table_group"><legend><span>Henvisninger</span></legend>
    <% f.semantic_fields_for :activity_referrals do |builder| %>
      <%= render 'activity_referral_fields', :f => builder %>
    <% end %>
    <p><%= link_to_add_fields "Tilføj henvisning", f, :activity_referrals %></p>
    </fieldset>

  <% end %>

  <% f.inputs :name => 'Arbejdsmetode' do %>
  <% end %>

  <% f.inputs :name => 'Materiel' do %>
  <% end %>

  <% f.inputs :name => 'Materialer' do %>
    <% f.semantic_fields_for :material_packages do |builder| %>
      <%= render 'material_package_fields', :f => builder %>
    <% end %>
    <p><%= link_to_add_fields "Tilføj Materialepakke", f, :material_packages %></p>

    <fieldset class="table_group"><legend><span>Henvisninger</span></legend>
    <% f.semantic_fields_for :material_referrals do |builder| %>
      <%= render 'material_referral_fields', :f => builder %>
    <% end %>
    <p><%= link_to_add_fields "Tilføj henvisning", f, :material_referrals %></p>
    </fieldset>

  <% end %>

  <% f.inputs :name => 'Mandskab' do %>
  <% end %>

  <%= f.buttons %>
<% end %>
